import numpy as np
import socket
import time
import datetime
import matplotlib
matplotlib.use('Agg')
from PIL import Image
from flask import Flask, send_file

import matplotlib.pyplot as plt

app = Flask(__name__)



HOST = 'localhost'
PORT = 12345

count =0
#while True:
while count<20:
	with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
		s.connect((HOST, PORT))

		data = s.recv(1024)
		print("Tempterature received: " , data.decode())
		print("\n")

		x = datetime.datetime.now()
		y = int(data.decode()) 

		plt.plot(x, y)
		plt.gcf().autofmt_xdate()
		count+=1

	time.sleep(0.5)

print("saving plot")
plt.savefig('tempChart.png')


@app.route('192.168.7.1/plot')
def serve_plot():
	return send_file('tempChart.png', mimetype='image/png')


if __name__ == '__main__':
	app.run(debug=True)

#plot it in a chart
#send chart to web server

